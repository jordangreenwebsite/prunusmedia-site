import{j as e,u as s}from"./fields-GHpMjljq.js";import{a as b,R as C,L as B,u as V}from"./vendor-BmsXziqF.js";import{b as T,F as I,u as Y,a as G}from"./index.esm-Cy9FKwRd.js";import{M as O,s as R,L as z}from"./Layout-6tbtb2_L.js";import{P as f,u as S,i as L,B as y,s as v,D as H,n as j,E as D,F as U,a as W,b as F,m as J,c as K,L as Q,A as X,w as Z}from"./index-N_DirKM7.js";import{I as E}from"./InputHidden-CbKoMq6o.js";import{L as P}from"./Label-BSdZmFpZ.js";import{I as w}from"./Input-ClJTi6Yp.js";import{d as ee,w as se}from"./bundle.esm.min-B-HQpnrw.js";import{a as te}from"./validation-CIogi1T7.js";import{u as ae}from"./index-CrI7X7RI.js";import{B as le}from"./index-DlLik32x.js";import{P as re}from"./index-Dohps0ay.js";const N=({record:t,page:d,perPage:h,mode:x="save"})=>{const c=S(),[a,i]=b.useState(!1),[p,n]=b.useState(!0),l=T({mode:"onChange"}),u=()=>e.jsxs("div",{className:"flex-between s-8",children:[e.jsx("span",{children:s("Dataset label")}),e.jsx("a",{href:"#",onClick:r=>{r.preventDefault(),n(!p)},children:s(`${p?"Auto slug ON":"Auto slug OFF"}`)})]}),g=r=>{c(H(r)).then(A=>{const k=A.payload;k.success?(i(!a),j.success(s("Dataset successfully saved")),c(D({page:d||1,perPage:h}))):j.error(k.error)})};return e.jsxs(C.Fragment,{children:[e.jsx(O,{size:"large",title:s(t?"Edit dataset":"Create a new dataset"),visible:a,buttons:[],children:e.jsx(I,{...l,children:e.jsxs("form",{onSubmit:l.handleSubmit(g),children:[e.jsx(E,{register:l.register,id:"emptyItems",value:0}),e.jsxs("div",{className:"flex-column s-24",children:[t&&e.jsx(C.Fragment,{children:e.jsx(E,{register:l.register,id:"id",value:t.id})}),e.jsxs("div",{className:"container",children:[e.jsxs("div",{className:"col-6",children:[e.jsx(P,{id:"label",label:u()}),e.jsx(w,{id:"label",register:l.register,placeholder:s("Dataset label"),defaultValue:x==="edit"&&!L(t)?t.label:"dataset name",errors:l.formState.errors,onChangeCapture:r=>{p&&l.setValue("name",ee(se(r.target.value)))},onClick:r=>{(r.target.value==="dataset_name"||r.target.value==="dataset name")&&l.resetField("label")},validate:{maxLength:{value:255,message:"max length is 255"}}})]}),e.jsxs("div",{className:"col-6",children:[e.jsx(P,{id:"name",label:s("Dataset name")}),e.jsx(w,{id:"name",register:l.register,placeholder:s("Dataset name"),defaultValue:x==="edit"&&!L(t)?t.name:"dataset_name",errors:l.formState.errors,isRequired:!0,onClick:r=>{(r.target.value==="dataset_name"||r.target.value==="dataset name")&&l.resetField("name")},validate:{validate:te,required:s("This field is mandatory"),maxLength:{value:255,message:"max length is 255"}}})]})]}),e.jsxs("div",{className:"i-flex-center s-8",children:[e.jsx(y,{testId:"save-form",style:v.PRIMARY,type:"submit",children:s("Save")}),e.jsx(y,{style:v.DANGER,type:"button",onClick:()=>{i(!a)},children:s("Close")})]})]})]})})}),x==="save"?e.jsx(y,{testId:"create-form",type:"button",onClick:()=>{i(!a)},style:v.PRIMARY,children:s("Create dataset")}):e.jsx("a",{href:"#",onClick:r=>{r.preventDefault(),i(!a)},children:s("Edit")})]})};N.propTypes={mode:f.oneOf(["edit","save"]).isRequired,page:f.number,perPage:f.number,record:f.object};const M=({id:t,page:d,perPage:h})=>{const x=S(),[c,a]=b.useState(!1),i=()=>{x(U(t)).then(n=>{const l=n.payload;l.success?(a(!c),j.success(s("Dataset successfully deleted.")),x(D({page:d||1,perPage:h}))):j.error(l.error)}).catch(n=>{j.error(n)})},p=[e.jsx(y,{style:v.DANGER,onClick:()=>{i()},children:s("Yes, delete it")}),e.jsx(y,{style:v.SECONDARY,onClick:()=>{a(!c)},children:s("Return back to list")})];return e.jsxs(C.Fragment,{children:[e.jsx(O,{title:s("Delete dataset"),buttons:p,visible:c,children:e.jsx("div",{children:s("You are going to delete this dataset. Are you sure?")})}),e.jsx("a",{href:"#",onClick:n=>{n.preventDefault(),a(!c)},children:s("Delete")})]})};M.propTypes={page:f.number,perPage:f.number,id:f.string.isRequired};const _=({record:t})=>{const{register:d}=Y(),h=`elements.${t.id}`;return e.jsxs("tr",{children:[e.jsx("td",{style:{width:"24px"},children:e.jsxs("label",{"data-cy":`select-${t.name}`,className:"checkbox",htmlFor:h,children:[e.jsx("input",{type:"checkbox",id:h,name:h,defaultChecked:!1,...d(h)}),e.jsx("span",{})]})}),e.jsx("td",{children:t.name}),e.jsx("td",{children:t.label}),e.jsx("td",{children:t.items.length}),e.jsx("td",{children:e.jsxs("div",{"data-cy":`form-links-${t.name}`,className:"i-flex-center s-8",children:[e.jsx(N,{mode:"edit",record:t}),e.jsx(B,{to:`/tools/dataset/${t.id}`,children:s("Manage")}),e.jsx(M,{id:t.id})]})})]})};_.propTypes={record:f.object.isRequired};const ve=()=>{const t=document.globals,d=t.settings,h=t.globals,[x]=ae(),c=b.useRef(),a=T({mode:"all"}),i=G({control:a.control,name:"elements"}),p=S(),{data:n,loading:l}=W(o=>o.fetchDatasets),{page:u}=V(),g=d.length>0&&F(d,"key","records_per_page")!==""?F(d,"key","records_per_page").value:20,r=Math.ceil(n.count/g);b.useEffect(()=>{R(),J(s("Dataset list")),K("#/tools"),p(D({page:u||1,perPage:g}))},[u]),b.useEffect(()=>{(()=>{if(!i)return!1;let m=0;for(const[ne,q]of Object.entries(i))q===!0&&m++;return m===Object.entries(i).length})()?c.current.checked=!0:c.current&&(c.current.checked=!1)},[i]);const A=()=>{if(!i)return!1;for(const[o,m]of Object.entries(i))if(m===!0)return!0;return!1},k=o=>{o.action&&(a.reset(),o.belongsTo="dataset",Z("bulkActionsAction",o).then(m=>{if(m.success===!0)switch(o.action){case"delete":j.success(s("Dataset successfully deleted.")),a.resetField("elements"),R(),p(D({page:u||1,perPage:g}));break}else j.error(m.error)}).catch(m=>{console.error(m),j.error(s("Unknown error, please retry later"))}))},$=[e.jsx(N,{page:u||1,perPage:g,mode:"save"})];return l?e.jsx(Q,{}):e.jsx(I,{...a,children:e.jsx("form",{onSubmit:a.handleSubmit(k),children:e.jsxs(z,{title:s("Dataset"),actions:$,crumbs:[{label:s("ACPT Tools"),link:"/tools"},{label:s("Dataset")}],children:[e.jsx("div",{ref:x,children:A()&&e.jsx(le,{})}),n.records&&n.records.length>0?e.jsx("div",{className:"responsive",children:e.jsxs("table",{className:`acpt-table with-shadow ${h.is_rtl?"rtl":""}`,children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{style:{width:"24px"},children:e.jsxs("label",{className:"checkbox",htmlFor:"all",children:[e.jsx("input",{ref:c,type:"checkbox",id:"all",defaultChecked:!1,onClick:o=>{n.records.map(m=>{a.setValue(`elements.${m.id}`,o.currentTarget.checked)})}}),e.jsx("span",{})]})}),e.jsx("th",{children:s("Name")}),e.jsx("th",{children:s("Label")}),e.jsx("th",{children:s("Items count")}),e.jsx("th",{children:s("Actions")})]})}),e.jsx("tbody",{children:n.records&&n.records.map(o=>e.jsx(_,{record:o},o.id))}),r>1&&e.jsx("tfoot",{children:e.jsx("tr",{children:e.jsx("td",{colSpan:5,children:e.jsx(re,{currentPage:u?parseInt(u):1,totalPages:r,baseLink:"/tools/dataset"})})})})]})}):e.jsx(X,{style:v.SECONDARY,children:s("No dataset found.")})]})})})};export{ve as default};
