import{j as e,u as t}from"./fields-GHpMjljq.js";import{a as I,R as P,h as Le}from"./vendor-BmsXziqF.js";import{P as l,s as N,I as A,u as q,B as R,ad as ue,w as pe,n as _,r as he,a as E,ae as ze,af as Ye,ag as ee,ah as L,ai as W,aj as Be,ak as Ge,al as We,am as me,v as se,A as te,an as He,ao as ge,ap as Ue,aq as Ke,ar as Qe,as as Je,at as Xe,au as Ze,av as es,m as ss,c as ts,K as as,aw as ls,L as ns,i as ce,ax as is}from"./index-N_DirKM7.js";import{a as O,B as xe,M as H,L as rs}from"./Layout-6tbtb2_L.js";import{u as C,a as D,c as z,g as fe,b as ds,F as os}from"./index.esm-Cy9FKwRd.js";import{S as U,L as cs}from"./index-BmCAbJhb.js";import{a as K,u as ae,C as le}from"./sortable.esm-FQQt9Bz4.js";import{d as B,w as G}from"./bundle.esm.min-B-HQpnrw.js";import{I as us}from"./InputHidden-CbKoMq6o.js";import{T as F}from"./index-CmFkX8j0.js";import{L as $}from"./Label-BSdZmFpZ.js";import{a as ps}from"./validation-CIogi1T7.js";import{I as Z}from"./Input-ClJTi6Yp.js";import{S as hs}from"./Select-DTKZAkjT.js";import{I as ms,M as gs}from"./MenuPosition-C3sQEueu.js";import{u as ne}from"./index-CrI7X7RI.js";import{S as ve}from"./index-B-IqvbBi.js";import{P as xs}from"./index-CNI3N7GO.js";import"./index-BwVKM9Kw.js";import"./index-CoDmPiQC.js";const ie=({index:s,parentPageIndex:d,page:n})=>{const c=()=>n.parentId?`pages.${d}.children.${s}.menuTitle`:`pages.${s}.menuTitle`,{control:o}=C(),r=D({control:o,name:c()}),h=document.globals.globals,[m,g]=I.useState(!1);return n.parentId?e.jsxs("div",{className:"tree-el flex-between s-8",style:{"--level":0},children:[e.jsx("span",{className:"text-ellipsis cursor-pointer",onClick:i=>{i.preventDefault(),O(`lazy-${n.id}`)},children:r||n.menuTitle}),e.jsx(xe,{style:N.SECONDARY,children:"C"})]}):e.jsxs("div",{className:"b-rounded with-shadow bg-white p-24",children:[e.jsxs("h3",{className:`${!m&&n.children&&n.children.length>0?"mb-24":""} flex-between s-8`,children:[e.jsx("span",{className:"cursor-pointer top-2",onClick:()=>g(!m),children:e.jsx(A,{width:18,icon:m?"bx:chevron-up":"bx:chevron-down",color:"#777"})}),e.jsx("span",{className:"text-ellipsis cursor-pointer",onClick:i=>{i.preventDefault(),O(`lazy-${n.id}`)},children:r||n.menuTitle})]}),!m&&n.children&&n.children.length>0&&e.jsx("div",{className:`tree ${h.is_rtl===!0?"rtl":""}`,children:n.children.map((i,a)=>e.jsx(P.Fragment,{children:e.jsx(ie,{page:i,parentPageIndex:s,index:a})}))})]},n.id)};ie.propTypes={index:l.number.isRequired,parentPageIndex:l.number,page:l.object.isRequired};const be=({pages:s})=>s.length===0?null:e.jsx(P.Fragment,{children:s.map((d,n)=>e.jsx(ie,{index:n,page:d}))});be.propTypes={pages:l.array.isRequired};const je=({page:s,index:d,parentPageIndex:n,parentSetActiveTab:c})=>{const o=q(),[r,b]=I.useState(!1),h=()=>s.parentId?`pages.${n}.children`:"pages",{control:m}=C(),{remove:g}=z({control:m,name:h()}),i=[e.jsx(R,{style:N.SUCCESS,onClick:a=>{a.preventDefault(),o(ue({page:s})),b(!r),c&&c(0),g(d)},children:t("Yes")}),e.jsx(R,{style:N.DANGER,onClick:a=>{a.preventDefault(),b(!r)},children:t("No")})];return e.jsxs(P.Fragment,{children:[e.jsx(H,{title:t("Confirm deleting page"),visible:r,buttons:i,children:t("Are you sure?")}),e.jsx("a",{href:"#",onClick:a=>{a.preventDefault(),b(!r)},children:e.jsx(A,{icon:"bx-trash",width:18})})]})};je.propTypes={index:l.number.isRequired,parentPageIndex:l.number,page:l.object.isRequired,parentSetActiveTab:l.func};const ye=({page:s,index:d,parentPageIndex:n,parentSetActiveTab:c,parentId:o})=>{const[r,b]=I.useState(!1),[h,m]=I.useState(null),[g,i]=I.useState(null),{control:a}=C(),x=D({control:a,name:"pages"}),y=u=>{m(u)},p=()=>{pe("copyOptionPageAction",{targetPageId:h,pageId:s.id,deletePage:g}).then(u=>{u.success?(_.success(`${t("Page was successfully copied")}.${t("The browser will refresh after 5 seconds.")}`),b(!r),he(5e3)):_.error(u.error)}).catch(u=>console.error(u))};return e.jsxs(P.Fragment,{children:[e.jsx(H,{title:t("Copy this meta option page"),visible:r,buttons:[],children:e.jsxs("div",{className:"flex-column s-24",children:[e.jsxs("div",{children:[e.jsx("label",{className:"form-label i-flex-center s-4",htmlFor:"page",children:t("Option page")}),e.jsx("div",{className:"acpt-select",children:e.jsxs("select",{id:"page",className:"form-control",onChange:u=>y(u.target.value),children:[e.jsx("option",{value:null,children:t("Select")}),x.map(u=>e.jsx("option",{value:u.id,children:u.pageTitle}))]})})]}),h&&e.jsxs("div",{children:[e.jsxs("div",{className:"w-100 i-flex-center s-4 mb-8",children:[e.jsx("input",{type:"checkbox",defaultValue:g,onClick:()=>i(!g),id:"deletePage"}),e.jsx("label",{htmlFor:"deletePage",children:t("Delete the meta option page after copying")})]}),e.jsx(R,{onClick:()=>p(),style:N.PRIMARY,children:t("Copy")})]})]})}),e.jsx("a",{href:"#",onClick:u=>{u.preventDefault(),b(!r)},children:e.jsx(A,{icon:"bx:copy",width:18})})]})};ye.propTypes={parentId:l.string.isRequired,index:l.number.isRequired,parentPageIndex:l.number,page:l.object.isRequired,parentSetActiveTab:l.func};const Q=({element:s})=>{const d=q(),{selectedElements:n}=E(o=>o.optionPagesState),c=()=>n.filter(r=>r.id===s.id).length>0;return e.jsx(F,{label:e.jsxs("label",{className:"checkbox",htmlFor:`select-${s.id}`,style:{top:"3px"},children:[e.jsx("input",{id:`select-${s.id}`,type:"checkbox",checked:c(),onChange:o=>{d(ze({element:s,selected:o.target.checked}))}}),e.jsx("span",{})]}),icon:!1,tip:t(c()?"Deselect this element":"Select this element")})};Q.propTypes={element:l.object.isRequired};const Ne=({page:s,view:d,listeners:n,attributes:c,index:o,parentPageIndex:r,formId:b,parentSetActiveTab:h})=>{const{formState:{errors:m},control:g}=C(),i=D({control:g,name:b("menuTitle")}),a=D({control:g,name:b()}),x=q(),{closedElements:y}=E(S=>S.optionPagesState),p=()=>y.filter(k=>k===s.id).length===1,u=()=>!(typeof s.isSaved<"u"&&s.isSaved===!1),f=()=>{const S=b("menuSlug"),k=fe(m,S);return k?e.jsx("span",{className:"invalid-feedback",children:t(k.message)}):i||s.menuTitle},w=()=>{Be(s.id),p()?x(Ge({id:s.id})):x(We({id:s.id}))};return e.jsxs("div",{className:"flex-between s-8 for-xs",children:[e.jsxs("span",{className:"i-flex-center s-8",children:[d==="list"&&e.jsx("span",{className:"cursor-move top-2 handle",...c,...n,children:e.jsx(A,{icon:"bx:dots-vertical-rounded",color:"#777",width:18})}),e.jsx(Q,{element:s}),e.jsx("h3",{children:f()})]}),e.jsxs("span",{className:"i-flex-center s-8",children:[u()&&e.jsxs(P.Fragment,{children:[e.jsx(F,{label:e.jsx("a",{href:"#",onClick:S=>{S.preventDefault();let k;s.parentId!==null?(k=Ye(s.parentId,a),h(s.children.length)):k=ee(a),x(L({page:k})),W(1).then(()=>{O(k.id)})},children:e.jsx(A,{icon:"bx:duplicate",width:18})}),tip:t("Duplicate this option page"),icon:!1}),s.parentId&&e.jsx(F,{label:e.jsx(ye,{parentId:s.parentId,index:o,parentPageIndex:r,parentSetActiveTab:h,page:s}),tip:t("Copy this option page"),icon:!1}),e.jsx(F,{label:e.jsx(je,{index:o,parentPageIndex:r,parentSetActiveTab:h,page:s}),tip:t("Delete this option page"),icon:!1})]}),d==="list"&&e.jsx(F,{label:e.jsx("a",{href:"#",onClick:S=>{S.preventDefault(),w()},children:e.jsx(A,{icon:"bx:expand-alt",width:18})}),tip:t("Hide/show this page"),icon:!1})]})]})};Ne.propTypes={index:l.number.isRequired,parentPageIndex:l.number,page:l.object.isRequired,parentSetActiveTab:l.func,listeners:l.func,attributes:l.func,formId:l.func.isRequired,view:l.oneOf(["list","tabular"]).isRequired};const Se=({innerRef:s,size:d="default",placeholder:n,id:c,defaultValue:o,description:r,readOnly:b,onChangeCapture:h,validate:m,register:g,errors:i,disabled:a=!1})=>{const x=fe(i,c);return e.jsxs(P.Fragment,{children:[e.jsx("textarea",{rows:8,ref:s,id:c,"data-cy":`textarea-${c}`,name:c,disabled:a,defaultValue:o,placeholder:n,onChangeCapture:h,readOnly:b,"aria-invalid":x?"true":"false",className:`form-control ${d} ${x?"has-errors":""}`,...g(c,m)}),x&&e.jsx("div",{className:"invalid-feedback",children:x.message}),r&&e.jsx("div",{className:"form-description",children:r})]})};Se.propTypes={id:l.string.isRequired,size:l.oneOf(["default","sm"]),innerRef:l.func,placeholder:l.string,defaultValue:l.string,description:l.string,readOnly:l.bool,onChangeCapture:l.func,validate:l.func,register:l.func.isRequired,errors:l.array.isRequired,disabled:l.bool};const Ie=({parentPageIndex:s,pages:d,setActiveTab:n})=>{const c=q(),[o]=ne(),{control:r}=C(),{move:b}=z({control:r,name:`pages.${s}.children`}),h=m=>{const{active:g,over:i}=m;if(g.id===i.id)return;const a=d.findIndex(p=>p.id===g.id),x=d.findIndex(p=>p.id===i.id),y=K(d,a,x);b(a,x),c(me({parentPageIndex:s,sortedPages:y}))};return e.jsx(U,{onDragEnd:h,items:d,children:e.jsx("div",{className:"flex-column s-24",ref:o,children:d.map((m,g)=>e.jsx(Y,{index:g,parentPageIndex:s,parentSetActiveTab:n,view:"list",page:m},m.id))})})};Ie.propTypes={setActiveTab:l.func,pages:l.array.isRequired,parentPageIndex:l.number};const Pe=({page:s,isActive:d,parentPageIndex:n,index:c,onClick:o})=>{const{control:r}=C(),b=D({control:r,name:`pages.${n}.children.${c}.menuTitle`}),{attributes:h,listeners:m,setNodeRef:g,transform:i}=ae({id:s.id}),a={transform:le.Translate.toString(i)};return e.jsx(P.Fragment,{children:e.jsx("div",{className:`acpt-btn-switch ${d?"active":""}`,ref:g,style:a,onClick:()=>{o(c)},children:e.jsxs("div",{className:"i-flex-center s-8",children:[e.jsx("span",{className:"cursor-move top-2 handle",...h,...m,children:e.jsx(A,{icon:"bx:dots-vertical-rounded",color:"#777",width:18})}),e.jsx(Q,{element:s}),e.jsx("span",{className:"text-ellipsis",style:{maxWidth:"200px"},children:b||s.menuTitle})]})})})};Pe.propTypes={parentPageIndex:l.number.isRequired,index:l.number.isRequired,isActive:l.bool.isRequired,page:l.object.isRequired,onClick:l.func.isRequired};const we=({parentPageId:s,parentPageIndex:d,pages:n,activeTab:c,setActiveTab:o})=>{const r=q(),{control:b}=C(),{move:h}=z({control:b,name:`pages.${d}.children`}),m=()=>{const a={id:se(),pageTitle:"New option child page",menuTitle:"Menu child title",menuSlug:"menu_child_slug",icon:null,position:99,description:null,parentId:s,capability:"manage_options",children:[],isSaved:!1};r(L({page:a})),o(n.length),W(1).then(()=>{O(a.id)})},g=i=>{const{active:a,over:x}=i;if(a.id===x.id)return;const y=n.findIndex(f=>f.id===a.id),p=n.findIndex(f=>f.id===x.id),u=K(n,y,p);h(y,p),o(p),r(me({parentPageIndex:d,sortedPages:u}))};return e.jsxs(P.Fragment,{children:[e.jsxs("div",{className:"flex-wrap i-flex-center s-8 mb-12",children:[e.jsx(U,{items:n,onDragEnd:g,mode:"horizontal",children:n&&n.map((i,a)=>e.jsx(Pe,{index:a,parentPageIndex:d,isActive:a===c,page:i,onClick:o}))}),e.jsx(R,{type:"button",style:N.SECONDARY,size:"sm",onClick:i=>{i.preventDefault(),m()},children:"+"})]}),n.map((i,a)=>e.jsx(P.Fragment,{children:a===c&&e.jsx("div",{className:"tab-panel",children:e.jsx(Y,{index:a,parentPageIndex:d,view:"tabular",page:i,parentSetActiveTab:o},i.id)})}))]})};we.propTypes={activeTab:l.number.isRequired,setActiveTab:l.func.isRequired,pages:l.array.isRequired,parentPageIndex:l.number};const Y=({page:s,index:d,parentPageIndex:n,parentSetActiveTab:c,view:o})=>{const{attributes:r,listeners:b,setNodeRef:h,transform:m}=ae({id:s.id}),g={transform:le.Translate.toString(m)},[i]=ne(),{register:a,control:x,formState:{errors:y},setValue:p,resetField:u,clearErrors:f,setError:w}=C(),S=D({control:x,name:"pages"}),k=q(),{closedElements:qe}=E(v=>v.optionPagesState),[V,Ae]=I.useState(!0),De=()=>{const T={id:se(),pageTitle:"New option child page",menuTitle:"Menu child title",menuSlug:"menu_child_slug",icon:null,position:99,description:null,parentId:s.id,capability:"manage_options",children:[],isSaved:!1};k(L({page:T})),J(s.children.length),W(1).then(()=>{O(T.id)})},[_e,J]=I.useState(0),Ee=[{label:t("Moderate comments"),value:"moderate_comments"},{label:t("Manage options"),value:"manage_options"},{label:t("Manage categories"),value:"manage_categories"},{label:t("Manage links"),value:"manage_links"},{label:t("Unfiltered html"),value:"unfiltered_html"},{label:t("Edit others posts"),value:"edit_others_posts"},{label:t("Edit pages"),value:"edit_pages"},{label:t("Edit others pages"),value:"edit_others_pages"},{label:t("Edit published pages"),value:"edit_published_pages"},{label:t("Publish pages"),value:"publish_pages"},{label:t("Delete pages"),value:"delete_pages"},{label:t("Delete others pages"),value:"delete_others_pages"},{label:t("Delete published pages"),value:"delete_published_pages"},{label:t("Delete others posts"),value:"delete_others_posts"},{label:t("Delete private posts"),value:"delete_private_posts"},{label:t("Edit private posts"),value:"edit_private_posts"},{label:t("Read private posts"),value:"read_private_posts"},{label:t("Delete private pages"),value:"delete_private_pages"},{label:t("Edit private pages"),value:"edit_private_pages"},{label:t("Read private pages"),value:"read_private_pages"}],X=()=>qe.filter(T=>T===s.id).length===1,j=(v=null)=>{if(s.parentId){let M=`pages.${n}.children.${d}`;return v&&(M+=`.${v}`),M}let T=`pages.${d}`;return v&&(T+=`.${v}`),T},Me=()=>o==="list"?"with-shadow p-24":s.parentId?"with-border p-24":"",$e=()=>o==="list"?!0:s.children&&s.children.length===0,de=v=>{if(V){const T=B(G(v));oe(T)?w(j("menuSlug"),{message:t("Name is already taken")}):f(j("menuSlug"))}},oe=v=>{let T=[];if(S.map((M,Fe)=>{Fe!==d&&T.push(M.menuSlug),M.children&&M.children.length>0&&M.children.map((Oe,Ve)=>{Ve!==d&&T.push(Oe.menuSlug)})}),T.includes(v))return t("Name is already taken")};return e.jsx(cs,{id:s.id,size:{type:s.parentId?"child-page":"page",children:s.children.length},isClosed:X(),element:e.jsxs("div",{id:s.id,className:`bg-white b-rounded ${Me()}`,ref:o==="list"?h:null,style:o==="list"?g:null,children:[e.jsx(us,{id:j("id"),value:s.id,register:a}),e.jsx("div",{className:o==="tabular"||!X()&&o==="list"?"mb-24":"",children:e.jsx(Ne,{index:d,parentPageIndex:n,formId:j,view:o,page:s,attributes:r,listeners:b,parentSetActiveTab:c})}),e.jsx("div",{className:`${o==="tabular"||!X()&&o==="list"?"":"hidden"}`,children:e.jsxs("div",{className:"flex-column s-24",children:[e.jsxs("div",{className:"container align-end",children:[e.jsxs("div",{className:"col-4",children:[e.jsxs("div",{className:"flex-between s-8",children:[e.jsx($,{isRequired:!0,id:j("pageTitle"),label:t("Page title")}),e.jsx("a",{href:"#",onClick:v=>{v.preventDefault(),Ae(!V)},children:t(`${V?"Auto slug ON":"Auto slug OFF"}`)})]}),e.jsx(Z,{id:j("pageTitle"),register:a,errors:y,placeholder:t("Page title"),defaultValue:s.pageTitle,validate:{required:t("This field is mandatory"),validate:{checkIfNameIsValid:de},maxLength:{value:255,message:"max length is 255"}},onChangeCapture:v=>{V&&(p(j("menuTitle"),v.target.value),p(j("menuSlug"),B(G(v.target.value))))},onClick:v=>{(v.target.value==="New option page"||v.target.value==="New option child page")&&u(j("pageTitle"))}})]}),e.jsxs("div",{className:"col-4",children:[e.jsx($,{isRequired:!0,id:j("menuTitle"),label:t("Menu title")}),e.jsx(Z,{id:j("menuTitle"),register:a,errors:y,placeholder:t("Menu title"),defaultValue:s.menuTitle,validate:{required:t("This field is mandatory"),validate:{checkIfNameIsValid:de},maxLength:{value:255,message:"max length is 255"}},onChangeCapture:v=>{V&&(p(j("pageTitle"),v.target.value),p(j("menuSlug"),B(G(v.target.value))))},onClick:v=>{(v.target.value==="Menu title"||v.target.value==="Menu child title")&&u(j("menuTitle"))}})]}),e.jsxs("div",{className:"col-4",children:[e.jsx($,{isRequired:!0,id:j("menuSlug"),label:t("Menu slug")}),e.jsx(Z,{id:j("menuSlug"),register:a,errors:y,placeholder:t("Menu slug"),defaultValue:s.menuSlug,validate:{required:t("This field is mandatory"),validate:{alphanumericallyValid:ps,checkIfSlugIsValid:oe},maxLength:{value:255,message:"max length is 255"}},onChangeCapture:v=>{p(j("menuSlug"),B(G(v.target.value)))},onClick:v=>{(v.target.value==="menu_slug"||v.target.value==="menu_child_slug")&&u(j("menuSlug"))}})]})]}),e.jsxs("div",{className:"container align-end",children:[!s.parentId&&e.jsxs(P.Fragment,{children:[e.jsxs("div",{className:"col-4",children:[e.jsx($,{isRequired:!0,id:j("icon"),label:t("Menu icon")}),e.jsx(ms,{id:j("icon"),callback:v=>{p(j("icon"),v)},defaultValue:s.icon,register:a,errors:y,validate:{required:t("This field is mandatory")}})]}),e.jsxs("div",{className:"col-4",children:[e.jsx("div",{className:"flex-between s-8",children:e.jsx($,{isRequired:!0,id:j("position"),label:t("Menu position")})}),e.jsx(gs,{id:j("position"),defaultValue:s.position?s.position:99,register:a,setValue:p})]})]}),e.jsxs("div",{className:s.parentId?"col-12":"col-4",children:[e.jsx($,{isRequired:!0,id:j("capability"),label:t("Capability")}),e.jsx(hs,{id:j("capability"),defaultValue:s.capability,placeholder:t("Select capability"),errors:y,register:a,values:Ee,validate:{required:t("This field is mandatory")}})]})]}),e.jsxs("div",{children:[e.jsx($,{isRequired:!1,id:j("description"),label:t("Page description (will be displayed after the title)")}),e.jsx(Se,{id:j("description"),register:a,errors:y,placeholder:t("Page description (will be displayed after the title)"),defaultValue:s.description,validate:{maxLength:{value:255,message:"max length is 255"}}})]}),!s.parentId&&e.jsxs("div",{ref:i,className:"flex-column s-24",children:[s.children&&s.children.length>0?e.jsx("div",{children:o==="list"?e.jsx("div",{className:"p-24 bg-pale-gray b-rounded",children:e.jsx(Ie,{parentPageIndex:d,pages:s.children,setActiveTab:J})}):e.jsx(we,{activeTab:_e,setActiveTab:J,parentPageId:s.id,parentPageIndex:d,pages:s.children})}):e.jsx(te,{style:N.WARNING,children:t('No children already created. Create the first one now by clicking the button "Add child page"!')}),$e()&&e.jsx("div",{children:e.jsx(R,{testId:"add-child-page",style:N.SECONDARY,onClick:v=>{v.preventDefault(),De()},children:t("Add child page")})})]})]})})]})})};Y.propTypes={index:l.number.isRequired,parentPageIndex:l.number,page:l.object.isRequired,setActiveTab:l.func,view:l.oneOf(["list","tabular"]).isRequired};const Ce=({modalOpen:s,setModalOpen:d})=>{const{selectedElements:n}=E(a=>a.optionPagesState),[c,o]=I.useState(null),[r,b]=I.useState(null),{control:h}=C(),m=D({control:h,name:"pages"}),g=a=>{o(a)},i=()=>{let a=[];n.map(x=>{a.push(x.id)}),pe("copyOptionPagesAction",{targetPageId:c,pageIds:a,deletePage:r}).then(x=>{x.success?(_.success(`${t("Page was successfully copied")}.${t("The browser will refresh after 5 seconds.")}`),he(5e3)):_.error(x.error),d(!s)}).catch(x=>{console.error(x),_.error(t("Unknown error, please retry later")),d(!s)})};return e.jsx(H,{title:t("Copy this meta option page"),visible:s,buttons:[],children:e.jsxs("div",{className:"flex-column s-24",children:[e.jsxs("div",{children:[e.jsx("label",{className:"form-label i-flex-center s-4",htmlFor:"page",children:t("Option page")}),e.jsx("div",{className:"acpt-select",children:e.jsxs("select",{id:"page",className:"form-control",onChange:a=>g(a.target.value),children:[e.jsx("option",{value:null,children:t("Select")}),m&&m.map(a=>e.jsx("option",{value:a.id,children:a.pageTitle}))]})})]}),c&&e.jsxs("div",{children:[e.jsxs("div",{className:"w-100 i-flex-center s-4 mb-8",children:[e.jsx("input",{type:"checkbox",defaultValue:r,onClick:()=>b(!r),id:"deletePage"}),e.jsx("label",{htmlFor:"deletePage",children:t("Delete the meta option page after copying")})]}),e.jsx(R,{onClick:()=>i(),style:N.PRIMARY,children:t("Copy")})]})]})})};Ce.propTypes={modalOpen:l.bool.isRequired,setModalOpen:l.func.isRequired};const re=({view:s,setActiveTab:d})=>{const n=q(),{selectedElements:c}=E(p=>p.optionPagesState),{control:o,setValue:r,getValues:b}=C(),h=D({control:o,name:"pages"}),m=I.useRef(null),[g,i]=I.useState(null),[a,x]=I.useState(!1),y=()=>{c.map(p=>{switch(g){case"copy":x(!a);break;case"duplicate":let u;if(p.parentId!==null){const f=h.findIndex(S=>S.id===p.parentId),w=h[f].children.findIndex(S=>S.id===p.id);u=ee(h[f].children[w]),h[f].children.push(u)}else{const f=h.findIndex(w=>w.id===p.id);u=ee(h[f]),h.push(u)}n(L({page:u})),r("pages",h);break;case"delete":if(p.parentId!==null){const f=h.findIndex(S=>S.id===p.parentId),w=h[f].children.findIndex(S=>S.id===p.id);h[f].children.splice(w,1),r("pages",h)}else r("pages",h.filter(f=>f.id!==p.id));n(ue({page:p}));break}}),(g==="delete"||g==="duplicate")&&n(He()),m.current.value=""};return e.jsxs(P.Fragment,{children:[e.jsx(Ce,{modalOpen:a,setModalOpen:x}),c.length>0&&e.jsxs("div",{className:`flex-between ${s==="tab"?"mb-24":""}`,children:[e.jsxs("div",{children:[c.length," ",t("Selected items")]}),e.jsxs("div",{className:"i-flex-center s-8",children:[e.jsxs("select",{ref:m,className:"form-control sm",onChange:p=>{i(p.target.value!==""?p.target.value:null)},children:[e.jsx("option",{value:"",children:t("Select")}),e.jsx("option",{value:"copy",children:t("Copy")}),e.jsx("option",{value:"duplicate",children:t("Duplicate")}),e.jsx("option",{value:"delete",children:t("Delete")})]}),e.jsx(R,{style:N.WHITE,size:"sm",disabled:g===null,onClick:p=>{p.preventDefault(),y()},children:t("Execute")})]})]})]})};re.propTypes={view:l.oneOf(["tab","list"]).isRequired,setBoxTab:l.func,setFieldTab:l.func,setBlockTab:l.func};const Te=({pages:s,view:d,setView:n})=>{const c=q(),{closedElements:o}=E(i=>i.optionPagesState),[r]=ne(),{control:b}=C(),{move:h}=z({control:b,name:"pages"}),m=i=>{const{active:a,over:x}=i;if(a.id===x.id)return;const y=s.findIndex(f=>f.id===a.id),p=s.findIndex(f=>f.id===x.id),u=K(s,y,p);h(y,p),c(ge(u))},g=()=>{const i=Ue(s);o.length>0?(Ke(i),c(Qe())):(Je(i),c(Xe()))};return e.jsxs("div",{className:"container",children:[e.jsx("div",{className:"col-3 flex-column s-24 hidden-xs sticky",style:{top:"130px"},children:e.jsx(be,{pages:s})}),e.jsxs("div",{className:"col-9",children:[e.jsxs("div",{className:"flex-between mb-24 s-8 for-xs",children:[e.jsx("h3",{children:t("Manage option pages")}),e.jsxs("div",{className:"i-flex-center s-8",children:[e.jsx(F,{label:e.jsx(R,{css:{height:"40px"},style:N.WHITE,size:"xs",onClick:i=>{i.preventDefault(),g()},children:e.jsx(A,{icon:o.length>0?"ant-design:eye-outlined":"ant-design:eye-invisible-outlined",width:18})}),tip:t("Show/hide all pages"),icon:!1}),e.jsx(ve,{localStorageKey:"option_page_manage_view",setView:n,view:d,choices:["list","tabular"]})]})]}),e.jsxs("div",{className:s.length>0?"flex-column s-24":"","data-cy":"list-view-pages",ref:r,children:[e.jsx(re,{view:"list"}),s.length>0?e.jsx(U,{onDragEnd:m,items:s,children:s.map((i,a)=>e.jsx(Y,{index:a,view:"list",page:i},i.id))}):e.jsx(te,{style:N.WARNING,children:t('No options already created. Create the first one now by clicking the button "Add option"!')})]})]})]})};Te.propTypes={view:l.string.isRequired,setView:l.func.isRequired,pages:l.array.isRequired};const Re=({index:s,page:d,activeTab:n=0,onClick:c})=>{const{control:o}=C(),r=D({control:o,name:`pages.${s}.pageTitle`}),{attributes:b,listeners:h,setNodeRef:m,transform:g}=ae({id:d.id}),i={transform:le.Translate.toString(g)};return e.jsxs("div",{id:d.id,className:`flex-between s-8 tab ${n===s?"active":""}`,ref:m,style:i,onClick:()=>{c&&c(s)},children:[e.jsx("span",{className:"cursor-move top-2 handle",...b,...h,children:e.jsx(A,{icon:"bx:dots-vertical-rounded",color:"#777",width:18})}),e.jsx(Q,{element:d}),e.jsx("span",{className:"text-ellipsis",children:r||d.pageTitle}),e.jsx(xe,{style:s===n?N.SECONDARY:N.DISABLED,children:d.children?d.children.length:0})]})};Re.propTypes={index:l.number.isRequired,page:l.object.isRequired,activeTab:l.number};const ke=({pages:s,activeTab:d,setActiveTab:n,view:c,setView:o})=>{const r=q(),{control:b}=C(),{move:h}=z({control:b,name:"pages"}),m=i=>{const{active:a,over:x}=i;if(a.id===x.id)return;const y=s.findIndex(f=>f.id===a.id),p=s.findIndex(f=>f.id===x.id),u=K(s,y,p);h(y,p),n(p),r(ge(u))},g=i=>{n(i)};return e.jsxs(P.Fragment,{children:[e.jsxs("div",{className:"flex-between mb-24",children:[e.jsx("h3",{children:t("Manage option pages")}),e.jsx(ve,{localStorageKey:"option_page_manage_view",setView:o,view:c,choices:["list","tabular"]})]}),e.jsx(re,{view:"tab",setActiveTab:n}),e.jsx("div",{className:"acpt-horizontal-tabs","data-cy":"tabular-view-pages",children:s.length>0?e.jsxs(P.Fragment,{children:[e.jsx("div",{className:"tablist",children:e.jsx(U,{onDragEnd:m,items:s,children:s.map((i,a)=>e.jsx(Re,{index:a,page:i,activeTab:d,onClick:g}))})}),s.map((i,a)=>e.jsx(P.Fragment,{children:a===d&&e.jsx("div",{className:"tab-panel",children:e.jsx(Y,{index:a,view:"tabular",page:i,parentSetActiveTab:n},i.id)})}))]}):e.jsx(te,{style:N.WARNING,children:t('No pages already created. Create the first one now by clicking the button "Add page"!')})})]})};ke.propTypes={activeTab:l.number.isRequired,setActiveTab:l.func.isRequired,view:l.string.isRequired,setView:l.func.isRequired,pages:l.array.isRequired};const fs=()=>{const s=q(),{unregister:d}=C(),[n,c]=I.useState(!1),o=[e.jsx(R,{testId:"confirm-delete-all-pages",style:N.SUCCESS,onClick:r=>{r.preventDefault(),s(Ze()),d("pages"),c(!n)},children:t("Yes")}),e.jsx(R,{style:N.DANGER,onClick:r=>{r.preventDefault(),c(!n)},children:t("No")})];return e.jsxs(P.Fragment,{children:[e.jsx(H,{title:t("Confirm deleting all"),visible:n,buttons:o,children:t("Are you sure?")}),e.jsx(R,{testId:"delete-all-pages",style:N.DANGER,onClick:r=>{r.preventDefault(),c(!n)},children:t("Delete all")})]})},Fs=({})=>{const s=q(),{loading:d}=E(u=>u.fetchOptionPages),{pages:n}=E(u=>u.optionPagesState),[c,o]=I.useState(!1),[r,b]=I.useState(es("option_page_manage_view")),[h,m]=I.useState(0),g=Le(),i=ds({mode:"all"});I.useEffect(()=>{ss(t("Manage option pages")),ts("#/option-pages"),s(as({})).then(u=>{s(ls(u.payload.records)),u.payload.records&&u.payload.records.map((f,w)=>{i.setValue(`pages.${w}`,f)})}).catch(u=>{console.error(u),o(!0)})},[]);const a=()=>{const f={id:se(),pageTitle:"New option page",menuTitle:"Menu title",menuSlug:"menu_slug",icon:"admin-appearance",capability:"manage_options",position:99,description:null,parentId:null,children:[],isSaved:!1};s(L({page:f})),m(n.length),W(1).then(()=>{O(`lazy-${f.id}`)})},x=()=>!(i.formState.errors&&i.formState.errors.pages),y=u=>{s(is(u)).then(f=>{const w=f.payload;w.success?(g("/option-pages"),_.success(t("Option pages successfully saved"))):_.error(w.error)}).catch(f=>{_.error(f)})},p=[e.jsx(R,{testId:"add-page",style:N.SECONDARY,onClick:u=>{u.preventDefault(),a()},children:t("Add page")}),e.jsx(R,{testId:"save-pages",disabled:!x(),style:N.PRIMARY,children:t("Save")}),e.jsx(fs,{})];return d?e.jsx(ns,{}):c?e.jsx(xs,{}):e.jsx(os,{...i,children:e.jsx("form",{onSubmit:i.handleSubmit(y),children:e.jsx(rs,{title:t("Manage option pages"),actions:p,crumbs:[{label:t("Option pages"),link:"/option-pages"},{label:t("Manage option pages")}],children:r==="list"?e.jsx(Te,{setActiveTab:m,view:r,setView:b,pages:ce(n)?[]:n}):e.jsx(ke,{activeTab:h,setActiveTab:m,view:r,setView:b,pages:ce(n)?[]:n})})})})};export{Fs as default};
