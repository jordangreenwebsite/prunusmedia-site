import{j as e,u as s}from"./fields-GHpMjljq.js";import{a as C,R as L,u as Q}from"./vendor-BmsXziqF.js";import{P as E,u as S,B as j,s as b,k as P,I as w,a as N,l as X,o as Z,p as O,q as ee,v as V,t as Y,x as te,n as A,y as $,z,m as se,c as ae,L as le,A as ne,C as oe,D as ie}from"./index-N_DirKM7.js";import{u as T,c as M,a as F,b as re,F as ce}from"./index.esm-Cy9FKwRd.js";import{M as U,s as de,L as ue}from"./Layout-6tbtb2_L.js";import{L as me,S as pe}from"./index-BmCAbJhb.js";import{u as he,C as fe,a as xe}from"./sortable.esm-FQQt9Bz4.js";import{I as be}from"./InputHidden-CbKoMq6o.js";import{I as q}from"./Input-ClJTi6Yp.js";import{T as R}from"./index-CmFkX8j0.js";import{u as ve}from"./index-CrI7X7RI.js";import{g as je}from"./files-DkSZUltV.js";import"./index-BwVKM9Kw.js";const B=({id:t,index:i})=>{const r=S(),[c,o]=C.useState(!1),{control:a}=T(),{remove:m}=M({control:a,name:"items"}),x=[e.jsx(j,{style:b.SUCCESS,onClick:p=>{p.preventDefault(),r(P({id:t})),m(i),o(!c)},children:s("Yes")}),e.jsx(j,{style:b.DANGER,onClick:p=>{p.preventDefault(),o(!c)},children:s("No")})];return e.jsxs("span",{children:[e.jsx(U,{title:s("Confirm deleting option"),visible:c,buttons:x,children:s("Are you sure?")}),e.jsx("a",{href:"#",onClick:p=>{p.preventDefault(),o(!c)},children:e.jsx(R,{icon:!1,tip:s("Delete"),label:e.jsx(w,{icon:"bx-minus"})})})]})};B.propTypes={id:E.string.isRequired,index:E.number.isRequired};const G=({item:t,index:i})=>{const r=S(),{selectedElements:c}=N(u=>u.datasetState),o=()=>c.filter(K=>K.id===t.id).length>0,a=u=>`items.${i}.${u}`,{register:m,formState:{errors:x},control:p,setValue:v,resetField:h}=T(),f=F({control:p,name:a("value")}),l=F({control:p,name:a("label")}),{attributes:d,listeners:n,setNodeRef:y,transform:D}=he({id:t.id}),k={transform:fe.Translate.toString(D)},g=()=>t.label==="label"&&t.value==="value"?!0:t.label===t.value,[I,W]=C.useState(g()),_=()=>f||(t.value?t.value:null),J=()=>l||(t.label?t.label:null);return e.jsx(me,{id:t.id,size:{type:"dataset-item",children:0},isClosed:!1,element:e.jsxs("div",{className:"w-100 i-flex-center s-8",style:k,ref:y,children:[e.jsx(be,{id:a("id"),value:t.id,register:m}),e.jsx(R,{label:e.jsxs("label",{className:"checkbox",htmlFor:`select-${t.id}`,style:{top:"3px"},children:[e.jsx("input",{id:`select-${t.id}`,type:"checkbox",checked:o(),onChange:u=>{r(X({element:t,selected:u.target.checked}))}}),e.jsx("span",{})]}),icon:!1,tip:s(o()?"Deselect this element":"Select this element")}),e.jsx("span",{className:"cursor-move top-2 handle",...d,...n,children:e.jsx(w,{icon:"bx:dots-vertical-rounded",color:"#777",width:18})}),e.jsx("span",{className:"w-100",children:e.jsx(q,{id:a("label"),register:m,errors:x,defaultValue:J(),onChangeCapture:u=>{I&&v(a("value"),u.target.value)},onClick:u=>{t.label&&u.target.value==="label"&&h(a("label"))},validate:{required:s("This field is mandatory"),maxLength:{value:255,message:"max length is 255"}}})}),e.jsx("span",{className:"w-100",children:e.jsx(q,{id:a("value"),register:m,errors:x,defaultValue:_(),onChangeCapture:u=>{I&&v(a("label"),u.target.value)},onClick:u=>{t.value&&u.target.value==="value"&&h(a("value"))},validate:{required:s("This field is mandatory"),maxLength:{value:255,message:"max length is 255"}}})}),e.jsx("span",{className:"i-flex-center s-8",children:e.jsx(R,{label:e.jsx("button",{type:"button",className:`acpt-btn-switch ${I?"active":""}`,onClick:u=>{u.preventDefault(),W(!I)},children:e.jsx(w,{icon:"bx:bx-link",width:"18px"})}),tip:s(I?"Label and value are linked":"Label and value are unlinked"),icon:!1})}),e.jsx(B,{id:t.id,index:i})]})})};G.propTypes={item:E.object.isRequired,index:E.number.isRequired};const ye=()=>{const t=S(),[i,r]=C.useState(!1),{unregister:c}=T(),o=[e.jsx(j,{style:b.SUCCESS,onClick:a=>{a.preventDefault(),t(Z()),c("items"),r(!i)},children:s("Yes")}),e.jsx(j,{style:b.DANGER,onClick:a=>{a.preventDefault(),r(!i)},children:s("No")})];return e.jsxs(L.Fragment,{children:[e.jsx(U,{title:s("Confirm deleting all"),visible:i,buttons:o,children:s("Are you sure?")}),e.jsx(j,{type:"button",style:b.DANGER,onClick:a=>{a.preventDefault(),r(!i)},children:s("Delete all")})]})},ge=()=>{const t=S(),{items:i,selectedElements:r}=N(n=>n.datasetState),{control:c,setValue:o,getValues:a}=T(),m=F({control:c,name:"items"}),{append:x,remove:p}=M({control:c,name:"items"}),v=C.useRef(null),[h,f]=C.useState(null),l=()=>{r.map(n=>{switch(h){case"duplicate":const y=V(),D={id:y,label:n.label,value:n.value,isDefault:!1,sort:m.length+1};t(Y(D)),x({id:y,label:n.label,value:n.value});break;case"delete":const k=a("items").filter(g=>g.id!==n.id);o("items",k),t(P({id:n.id}));break}}),t(O())},d=()=>r.length===i.length;if(r.length>0)return e.jsxs("div",{className:"flex-between",children:[e.jsxs("div",{className:"i-flex-center s-8",children:[e.jsxs("span",{children:[r.length," ",s("Selected items")]}),e.jsx("span",{children:e.jsx("a",{href:"#",onClick:n=>{n.preventDefault(),n.stopPropagation(),d()?t(O()):t(ee())},children:s(d()?"deselect all":"select all")})})]}),e.jsxs("div",{className:"i-flex-center s-8",children:[e.jsxs("select",{ref:v,className:"form-control sm",onChange:n=>{f(n.target.value!==""?n.target.value:null)},children:[e.jsx("option",{value:"",children:s("Select")}),e.jsx("option",{value:"duplicate",children:s("Duplicate")}),e.jsx("option",{value:"delete",children:s("Delete")})]}),e.jsx(j,{style:b.WHITE,size:"sm",disabled:h===null,onClick:n=>{n.preventDefault(),l()},children:s("Execute")})]})]})},H=({id:t})=>{const i=S(),r=async c=>{const o=["json","csv","yaml"],a=c.target.files[0],m=je(a.name),x=a.type;if(!o.includes(m))return;let p=await a.text();const v=new File([p],a.name,{type:x});let h=new FormData;h.append("id",t),h.append("file",v),i(te(h)).then(f=>{const l=f.payload;l.success===!0?(A.success(s("File was successfully imported")),i($(t)).then(d=>{d.payload&&i(z(d.payload.items))}).catch(d=>{console.error(d)})):A.error(e.jsx("span",{dangerouslySetInnerHTML:{__html:l.error}}))}).catch(f=>{console.error(f),A(f)})};return e.jsxs(L.Fragment,{children:[e.jsx("input",{onChange:c=>r(c),style:{display:"none"},accept:"application/json, application/yaml,.csv,.yaml",name:"file",type:"file",id:"upload"}),e.jsx("label",{htmlFor:"upload",className:"acpt-btn acpt-btn acpt-btn-bordered",children:s("Import data")})]})};H.propTypes={id:E.string.isRequired};const Me=()=>{const{id:t}=Q(),i=S(),{data:r,loading:c}=N(l=>l.fetchDataset),{items:o}=N(l=>l.datasetState),[a]=ve();C.useEffect(()=>{de(),se(s("Manage dataset")),ae("#/tools"),i($(t)).then(l=>{l.payload&&i(z(l.payload.items))}).catch(l=>{console.error(l)})},[t]);const m=re({mode:"all"}),{move:x}=M({control:m.control,name:"items"}),p=()=>{const l={id:V(),label:"label",value:"value",isDefault:!1,sort:o.length+1};i(Y(l))},v=l=>{const{active:d,over:n}=l;if(d.id===n.id)return;const y=o.findIndex(g=>g.id===d.id),D=o.findIndex(g=>g.id===n.id),k=xe(o,y,D);x(y,D),i(oe(k))},h=l=>{i(ie({id:r.id,name:r.name,label:r.label,items:l.items?l.items:[],emptyItems:!0})).then(d=>{const n=d.payload;n.success?A.success(s("Dataset successfully saved")):A.error(n.error)})},f=[e.jsx(H,{id:t}),e.jsx(j,{style:b.SECONDARY,type:"button",onClick:()=>{p()},children:s("Add element")}),e.jsx(j,{testId:"save-form",style:b.PRIMARY,type:"submit",children:s("Save")}),e.jsx(ye,{})];return c?e.jsx(le,{}):e.jsx(ce,{...m,children:e.jsx("form",{onSubmit:m.handleSubmit(h),children:e.jsx(ue,{actions:f,title:s("Manage dataset"),crumbs:[{label:s("ACPT Tools"),link:"/tools"},{label:s("Dataset"),link:"/tools/dataset"},{label:s("Manage dataset")}],children:o&&o.length>0?e.jsxs("div",{ref:a,className:"flex-column s-24",children:[e.jsxs("h3",{children:["Manage dataset ",r.label?r.label:r.name," (",o.length,")"]}),e.jsx(ge,{}),e.jsx(pe,{onDragEnd:v,items:o,children:e.jsx(L.Fragment,{children:o.map((l,d)=>e.jsx(G,{index:d,item:l},l.id))})})]}):e.jsx(ne,{style:b.SECONDARY,children:s('No elements saved, generate the first one clicking on "Add element" button')})})})})};export{Me as default};
