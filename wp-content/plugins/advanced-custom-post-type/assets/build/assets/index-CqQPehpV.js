import{j as e,u as r}from"./fields-GHpMjljq.js";import{R as N,a as R}from"./vendor-BmsXziqF.js";import{L as F}from"./Layout-6tbtb2_L.js";import{P as d,u as L,a as u,m as M,j as v,H as _,J as $,K as A,B as I,s as q,L as J,M as Y,n as g}from"./index-N_DirKM7.js";import{u as O,b as w,F as G}from"./index.esm-Cy9FKwRd.js";import{S as B}from"./Select-DTKZAkjT.js";import{m}from"./metaTypes-Bb9tjSPe.js";import{I as b}from"./InputHidden-CbKoMq6o.js";import{E as D}from"./index-CkilzTBU.js";import{c as X}from"./json-k6xEkD73.js";import{d as H}from"./files-DkSZUltV.js";import"./browser-KE9NsxEH.js";const y=({element:a,index:n,type:s})=>{const{register:i}=O(),o=c=>`data.${s}.${n}.${c}`;return e.jsxs(N.Fragment,{children:[e.jsx(b,{register:i,id:o("id"),value:a.id}),e.jsx(b,{register:i,id:o("type"),value:s}),e.jsxs("tr",{children:[e.jsx("td",{children:e.jsxs("label",{className:"checkbox",htmlFor:o("checked"),children:[e.jsx("input",{name:s,type:"checkbox",id:o("checked"),defaultChecked:!0,...i(o("checked"))}),e.jsx("span",{})]})}),e.jsx("td",{style:{width:"200px"},children:e.jsxs("span",{children:[s===m.CUSTOM_POST_TYPE&&a.name,s===m.TAXONOMY&&a.slug,s===m.OPTION_PAGE&&a.pageTitle,s==="meta"&&a.name]})}),e.jsx("td",{children:s==="meta"?e.jsx("span",{children:a.fieldsCount}):e.jsx(D,{element:a})})]})]})};y.propTypes={element:d.object.isRequired,index:d.number.isRequired,type:d.string.isRequired};const p=({name:a,elements:n,type:s})=>{const{setValue:i}=O();return e.jsxs("table",{className:"acpt-table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{style:{width:"24px"},children:e.jsxs("label",{className:"checkbox",htmlFor:`${s}`,children:[e.jsx("input",{name:s,type:"checkbox",id:s,defaultChecked:!0,onClick:o=>{n.map((c,h)=>{i(`data.${s}.${h}.checked`,o.currentTarget.checked)})}}),e.jsx("span",{})]})}),e.jsx("th",{children:e.jsx("h3",{children:a})}),e.jsx("th",{children:r(s==="meta"?"Fields count":"Type")})]})}),e.jsx("tbody",{children:n&&n.map((o,c)=>e.jsx(y,{type:s,index:c,element:o}))})]})};p.propTypes={name:d.string.isRequired,elements:d.array.isRequired,type:d.string.isRequired};const re=()=>{const a=L(),{data:n,loading:s}=u(t=>t.fetchCustomPostTypes),{data:i,loading:o}=u(t=>t.fetchTaxonomies),{data:c,loading:h}=u(t=>t.fetchOptionPages),{data:T,loading:P}=u(t=>t.fetchMeta);R.useEffect(()=>{M(r("Export custom post types")),a(v()),a(_()),a($()),a(A({page:1,perPage:1e3}))},[]);let j=[];c&&c.records&&c.records.map(t=>{j.push(t),t.children&&t.children.map(l=>{j.push(l)})});const x=w({mode:"all"}),E=t=>{a(Y({format:t.format,data:t.data})).then(l=>{const f=l.payload;if(f.success===!0){const k=`acpt_export_${new Date().toJSON().slice(0,19)}.${t.format}`,C=t.format==="acpt"?X(JSON.stringify(f.data)):f.data;H(k,C),g.success(r("File was successfully exported"))}else g.error(l.error)}).catch(l=>{console.error(l),g(l)})},S=[e.jsx(B,{register:x.register,id:"format",values:[{label:"JSON compressed",value:"acpt"},{label:"JSON",value:"json"},{label:"XML",value:"xml"},{label:"YAML",value:"yaml"}],errors:x.formState.errors}),e.jsx(I,{testId:"export",style:q.PRIMARY,children:r("Export selected elements")})];return s&&o&&h&&P?e.jsx(J,{}):e.jsx(G,{...x,children:e.jsx("form",{onSubmit:x.handleSubmit(E),children:e.jsx(F,{title:r("Export data"),actions:S,crumbs:[{label:r("ACPT Tools"),link:"/tools"},{label:r("Export data")}],children:e.jsxs("div",{className:"flex-column s-24",children:[e.jsx(p,{elements:n?n.records:[],name:r("Custom post types"),type:m.CUSTOM_POST_TYPE}),e.jsx(p,{elements:i?i.records:[],name:r("Taxonomies"),type:m.TAXONOMY}),e.jsx(p,{elements:j,name:r("Option pages"),type:m.OPTION_PAGE}),e.jsx(p,{elements:T?T.records:[],name:r("Field groups"),type:"meta"})]})})})})};export{re as default};
