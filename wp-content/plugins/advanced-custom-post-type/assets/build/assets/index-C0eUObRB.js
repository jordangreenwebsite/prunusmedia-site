import{u as s,j as e}from"./fields-GHpMjljq.js";import{a as b,R as L,L as fe,u as xe}from"./vendor-BmsXziqF.js";import{M as z,B as pe,s as J,L as je}from"./Layout-6tbtb2_L.js";import{P as f,w as Q,A as K,s as _,u as Y,i as q,B as I,N as be,n as k,O as V,Q as ge,a as _e,b as W,m as ve,c as ye,L as Te}from"./index-N_DirKM7.js";import{u as O,a as G,b as Z,F as ee}from"./index.esm-Cy9FKwRd.js";import{I as U}from"./InputHidden-CbKoMq6o.js";import{L as P}from"./Label-BSdZmFpZ.js";import{I as R}from"./Input-ClJTi6Yp.js";import{d as Ae,w as Se}from"./bundle.esm.min-B-HQpnrw.js";import{a as Pe}from"./validation-CIogi1T7.js";import{S as D}from"./Select-DTKZAkjT.js";import{R as te,l as se}from"./index-CrIKKm_z.js";import{m as T}from"./metaTypes-Bb9tjSPe.js";import{T as Fe}from"./index-CmFkX8j0.js";import{M as Ce}from"./index-BK6Luaau.js";import{P as ke}from"./index-Dohps0ay.js";import{C as Ne}from"./index-D7G017Q_.js";import{B as Ee}from"./index-DlLik32x.js";import{u as Le}from"./index-CrI7X7RI.js";import"./objectWithoutPropertiesLoose-D8pFLZ8M.js";import"./index-BwVKM9Kw.js";const v={EMAIL:"EMAIL",PHP:"PHP",AJAX:"AJAX",CUSTOM:"CUSTOM",FILL_META:"FILL_META"},ae=[{label:s("Select"),value:null},{label:s("Ajax"),value:v.AJAX},{label:s("Custom"),value:v.CUSTOM},{label:s("Post management"),value:v.FILL_META},{label:s("PHP"),value:v.PHP}],g=(t,n,a=null)=>{if(t&&t.meta.length>0){const i=t.meta.filter(l=>l.key===n);return i.length>0?i[0].value:a}return a},le=({record:t})=>{const{register:n,setValue:a,formState:{errors:i}}=O(),l=`
// data contains the Promise response
console.log(data);
    `;return b.useEffect(()=>{(!t||t&&!t.ajax_action)&&a("meta.0.ajax_handling",l)},[]),e.jsxs(L.Fragment,{children:[e.jsxs("div",{children:[e.jsx(P,{id:"meta.0.ajax_action",label:s("Ajax action")}),e.jsx(R,{id:"meta.0.ajax_action",errors:i,register:n,defaultValue:g(t,"ajax_action"),validate:{required:s("This field is mandatory")}})]}),e.jsxs("div",{children:[e.jsx(P,{id:"meta.0.ajax_handling",label:s("Ajax success response handling")}),e.jsx("div",{className:"with-border b-rounded",children:e.jsx(te,{value:g(t,"ajax_handling",l),height:"250px",editable:!0,theme:"light",extensions:[se.jsx({})],onChange:o=>{a("meta.0.ajax_handling",o)}})})]})]})};le.propTypes={record:f.object};const ie=({record:t})=>{const{register:n,formState:{errors:a}}=O(),i=[{label:s("Select"),value:null},{label:"POST",value:"POST"},{label:"GET",value:"GET"}];return e.jsxs("div",{className:"container",children:[e.jsxs("div",{className:"col-6",children:[e.jsx(P,{id:"meta.0.custom_action",label:s("Custom action")}),e.jsx(R,{id:"meta.0.custom_action",errors:a,register:n,defaultValue:g(t,"custom_action"),validate:{required:s("This field is mandatory")}})]}),e.jsxs("div",{className:"col-6",children:[e.jsx(P,{id:"meta.1.custom_method",label:s("Method")}),e.jsx(D,{id:"meta.1.custom_method",errors:a,register:n,values:i,defaultValue:g(t,"custom_method"),validate:{required:s("This field is mandatory")}})]})]})};ie.propTypes={record:f.object};const ne=({record:t})=>{const{setValue:n}=O(),a=`<?php
// $_POST and $_FILES store form data already sanitized
// by HandleFormSubmissionCommand class
$data = $_POST;
$files = $_FILES;`;return b.useEffect(()=>{(!t||t&&!t.php_action)&&n("meta.0.php_action",a)},[]),e.jsxs("div",{children:[e.jsx(P,{id:"meta.0.php_action",label:s("PHP custom handling")}),e.jsx("div",{className:"with-border b-rounded",children:e.jsx(te,{value:g(t,"php_action",a),height:"250px",editable:!0,theme:"light",extensions:[se.php({})],onChange:i=>{n("meta.0.php_action",i)}})})]})};ne.propTypes={record:f.object};const Oe=()=>e.jsx("div",{children:"EmailAction"}),oe=({index:t,defaultChecked:n=!0,metaField:a})=>{const{register:i}=O(),l=`meta.3.fill_meta_fields.${t}`;return e.jsx(L.Fragment,{children:e.jsxs("tr",{children:[e.jsx("td",{children:e.jsxs("label",{className:"checkbox",htmlFor:`${l}`,children:[e.jsx("input",{name:l,value:a.id,defaultChecked:n,type:"checkbox",id:l,...i(`${l}`)}),e.jsx("span",{})]})}),e.jsx("td",{style:{width:"33%"},children:a.groupName}),e.jsx("td",{style:{width:"33%"},children:a.name}),e.jsx("td",{style:{width:"33%"},children:e.jsx(Ce,{fieldType:a.type,css:"top-2"})})]})})};oe.propTypes={index:f.number.isRequired,defaultChecked:f.bool,metaField:f.object.isRequired};const re=({defaultValue:t,metaFields:n})=>e.jsx("div",{style:{maxHeight:250,overflowY:"auto"},children:e.jsxs("table",{className:"acpt-table with-border b-rounded",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{}),e.jsx("th",{children:s("Group")}),e.jsx("th",{children:s("Field")}),e.jsx("th",{children:s("Type")})]})}),e.jsx("tbody",{children:n.length>0&&n.map((a,i)=>e.jsx(oe,{index:i,defaultChecked:t?t[i]===a.id:!0,metaField:a},a.id))})]})});re.propTypes={defaultValue:f.array,metaFields:f.array.isRequired};const ce=({record:t})=>{const a=document.globals.globals,[i,l]=b.useState(null),[o,c]=b.useState([]),[y,d]=b.useState(null),[r,p]=b.useState([]);b.useEffect(()=>{if(t&&t.meta.length>0){const m=g(t,"fill_meta_location_belong"),C=g(t,"fill_meta_location_find");if(m&&C){let j;m===T.CUSTOM_POST_TYPE&&(j="Post"),m===T.TAXONOMY&&(j="Taxonomy"),w(C,j)}}},[]);const{control:A,register:F,formState:{errors:N},setValue:M,resetField:u,getValues:x}=O(),h=G({control:A,name:"meta.0.fill_meta_location_belong"}),H=[{label:"Select",value:null},{label:s("Post"),options:a.find[T.CUSTOM_POST_TYPE].filter(m=>m.value!==null)},{label:s("Taxonomy"),options:a.find[T.TAXONOMY].filter(m=>m.value!==null)},{label:s("Option pages"),options:a.find[T.OPTION_PAGE].filter(m=>m.value!==null)},{label:s("All users"),value:T.USER}],w=(m,C)=>{let j;if(u("meta.0.fill_meta_location_belong"),l(null),d(null),c([]),m===T.USER){const S=[...a.find.USER_ID];S.splice(1,0,{label:s("Create new user"),value:"0"}),j=T.USER,l("User"),d("If blank, the current logged user ID will be used"),c(S)}if(C==="Post"){j=T.CUSTOM_POST_TYPE,l("Post"),d("If blank, the current post_ID will be used");const S=a.find.POST_ID.filter(E=>E.label===m);S.length===1&&c([{label:s("Create new post"),value:"0"},...S[0].options])}if(C==="Taxonomy"){j=T.TAXONOMY,l(s("Taxonomy")),d("If blank, the current queried term_ID will be used");const S=a.find.TERM_ID.filter(E=>E.label===m);S.length===1&&c([{label:s("Create new term"),value:"0"},...S[0].options])}C==="Option pages"&&(j=T.OPTION_PAGE),ue(m,j),M("meta.0.fill_meta_location_belong",j),u("meta.1.fill_meta_location_item")},ue=(m,C)=>{Q("fetchMetaAction",{find:m,belongsTo:C,formBuilder:!0}).then(j=>{let S=[];j.records.map(E=>{E.boxes.map(X=>{X.fields.map($=>{$.groupName=E.name,$.boxName=X.name,S.push($)})})}),p(S)}).catch(j=>console.error(j))},he=()=>h||g(t,"fill_meta_location_belong");return e.jsxs(L.Fragment,{children:[e.jsxs("div",{className:"container",children:[e.jsx(U,{register:F,id:"meta.0.fill_meta_location_belong",value:g(t,"fill_meta_location_belong")}),e.jsxs("div",{className:`col-${he()===T.OPTION_PAGE?12:6}`,children:[e.jsx(P,{id:"meta.1.fill_meta_location_find",label:s("List to populate from")}),e.jsx(D,{id:"meta.1.fill_meta_location_find",errors:N,register:F,values:H,defaultValue:g(t,"fill_meta_location_find"),onChangeCapture:m=>{w(m.target.value,m.target.selectedOptions[0].parentElement.dataset.original)},validate:{required:s("This field is mandatory")}})]}),i&&e.jsxs("div",{className:"col-6",children:[e.jsx(Fe,{label:e.jsx("label",{className:"form-label",htmlFor:"meta.2.fill_meta_location_item",children:s(i)}),tip:s(y)}),e.jsx("div",{className:"mt-4",children:e.jsx(D,{id:"meta.2.fill_meta_location_item",errors:N,register:F,values:o,defaultValue:g(t,"fill_meta_location_item","0")})})]})]}),r&&r.length>0?e.jsx(re,{defaultValue:g(t,"fill_meta_fields"),metaFields:r}):e.jsx(K,{style:_.WARNING,children:s("No fields registered.")})]})};ce.propTypes={record:f.object};const B=({record:t,page:n,perPage:a,mode:i="save"})=>{const l=Y(),[o,c]=b.useState(!1),[y,d]=b.useState(!0),r=Z({mode:"onChange"}),p=G({control:r.control,name:"action"}),A=()=>p||(t?t.action:null),F=()=>e.jsxs("div",{className:"flex-between s-8",children:[e.jsx("span",{children:s("Form label")}),e.jsx("a",{href:"#",onClick:u=>{u.preventDefault(),d(!y)},children:s(`${y?"Auto slug ON":"Auto slug OFF"}`)})]}),N=u=>{l(be(u)).then(x=>{const h=x.payload;h.success?(c(!o),k.success(s("Form successfully saved")),l(V({page:n||1,perPage:a}))):k.error(h.error)})},M=()=>r.getValues("action")?typeof r.getValues("action")<"u":t?t.action!=="":!1;return e.jsxs(L.Fragment,{children:[e.jsx(z,{size:"large",title:s(t?"Edit form":"Create a new form"),visible:o,buttons:[],children:e.jsx(ee,{...r,children:e.jsx("form",{onSubmit:r.handleSubmit(N),children:e.jsxs("div",{className:"flex-column s-24",children:[t&&e.jsxs(L.Fragment,{children:[e.jsx(U,{register:r.register,id:"id",value:t.id}),e.jsx(U,{register:r.register,id:"key",value:t.key})]}),e.jsxs("div",{className:"container",children:[e.jsxs("div",{className:"col-6",children:[e.jsx(P,{id:"label",label:F()}),e.jsx(R,{id:"label",register:r.register,placeholder:s("Form label"),defaultValue:i==="edit"&&!q(t)?t.label:"form name",errors:r.formState.errors,onChangeCapture:u=>{y&&r.setValue("name",Ae(Se(u.target.value)))},onClick:u=>{(u.target.value==="form_name"||u.target.value==="form name")&&r.resetField("label")},validate:{maxLength:{value:255,message:"max length is 255"}}})]}),e.jsxs("div",{className:"col-6",children:[e.jsx(P,{id:"name",label:s("Form name")}),e.jsx(R,{id:"name",register:r.register,placeholder:s("Form name"),defaultValue:i==="edit"&&!q(t)?t.name:"form_name",errors:r.formState.errors,isRequired:!0,onClick:u=>{(u.target.value==="form_name"||u.target.value==="form name")&&r.resetField("name")},validate:{validate:Pe,required:s("This field is mandatory"),maxLength:{value:255,message:"max length is 255"}}})]})]}),e.jsxs("div",{children:[e.jsx(P,{id:"action",label:s("Action")}),e.jsx(D,{id:"action",register:r.register,defaultValue:i==="edit"&&!q(t)?t.action:null,values:ae,errors:r.formState.errors,validate:{required:s("This field is mandatory")}})]}),e.jsxs("div",{children:[e.jsx(P,{id:"outcome_message",label:s("Successful outcome message")}),e.jsx(R,{id:"meta.4.outcome_message",register:r.register,defaultValue:g(t,"outcome_message","The form was successfully submitted"),errors:r.formState.errors,isRequired:!0,validate:{required:s("This field is mandatory"),maxLength:{value:255,message:"max length is 255"}}})]}),A()===v.AJAX&&e.jsx(le,{record:t}),A()===v.CUSTOM&&e.jsx(ie,{record:t}),A()===v.PHP&&e.jsx(ne,{record:t}),A()===v.EMAIL&&e.jsx(Oe,{record:t}),M()&&e.jsx(ce,{record:t}),e.jsxs("div",{className:"i-flex-center s-8",children:[e.jsx(I,{testId:"save-form",style:_.PRIMARY,type:"submit",children:s("Save")}),e.jsx(I,{style:_.DANGER,type:"button",onClick:()=>{c(!o)},children:s("Close")})]})]})})})}),i==="save"?e.jsx(I,{testId:"create-form",type:"button",onClick:()=>{c(!o)},style:_.PRIMARY,children:s("Create form")}):e.jsx("a",{href:"#",onClick:u=>{u.preventDefault(),c(!o)},children:s("Edit")})]})};B.propTypes={mode:f.oneOf(["edit","save"]).isRequired,page:f.number,perPage:f.number,record:f.object};const de=({id:t,page:n,perPage:a})=>{const i=Y(),[l,o]=b.useState(!1),c=()=>{i(ge(t)).then(d=>{const r=d.payload;r.success?(o(!l),k.success(s("Form successfully deleted.")),i(V({page:n||1,perPage:a}))):k.error(r.error)}).catch(d=>{k.error(d)})},y=[e.jsx(I,{style:_.DANGER,onClick:()=>{c()},children:s("Yes, delete it")}),e.jsx(I,{style:_.SECONDARY,onClick:()=>{o(!l)},children:s("Return back to list")})];return e.jsxs(L.Fragment,{children:[e.jsx(z,{title:s("Delete form"),buttons:y,visible:l,children:e.jsx("div",{children:s("You are going to delete this form. Are you sure?")})}),e.jsx("a",{href:"#",onClick:d=>{d.preventDefault(),o(!l)},children:s("Delete")})]})};de.propTypes={page:f.number,perPage:f.number,id:f.string.isRequired};const me=b.memo(({record:t})=>{const{register:n}=O(),a=`elements.${t.id}`,i=l=>{let o=_.SECONDARY;switch(l){case v.EMAIL:o=_.DANGER;break;case v.CUSTOM:o=_.WARNING;break;case v.PHP:o=_.INFO;break;case v.AJAX:o=_.SUCCESS;break;case v.FILL_META:o=_.PRIMARY;break}const c=ae.filter(y=>y.value===l)[0].label;return e.jsx(pe,{style:o,children:c})};return e.jsxs("tr",{children:[e.jsx("td",{style:{width:"24px"},children:e.jsxs("label",{"data-cy":`select-${t.name}`,className:"checkbox",htmlFor:a,children:[e.jsx("input",{type:"checkbox",id:a,name:a,defaultChecked:!1,...n(a)}),e.jsx("span",{})]})}),e.jsx("td",{children:t.name}),e.jsx("td",{children:t.label}),e.jsx("td",{children:i(t.action)}),e.jsx("td",{children:e.jsx(Ne,{text:`[acpt_form id="${t.key}"]`})}),e.jsx("td",{children:e.jsxs("div",{"data-cy":`form-links-${t.name}`,className:"i-flex-center s-8",children:[e.jsx(B,{mode:"edit",record:t}),e.jsx(fe,{to:`/form/${t.id}`,children:s("Manage")}),e.jsx(de,{id:t.id})]})})]})});me.propTypes={record:f.object.isRequired};const Me=()=>{const t=document.globals,n=t.settings,a=t.globals,[i]=Le(),l=b.useRef(),o=Z({mode:"all"}),c=G({control:o.control,name:"elements"}),y=Y(),{data:d,loading:r}=_e(x=>x.fetchForms),{page:p}=xe(),A=n.length>0&&W(n,"key","records_per_page")!==""?W(n,"key","records_per_page").value:20,F=Math.ceil(d.count/A);b.useEffect(()=>{J(),ve(s("Forms list")),ye("#/forms"),y(V({page:p||1,perPage:A}))},[p]),b.useEffect(()=>{(()=>{if(!c)return!1;let h=0;for(const[H,w]of Object.entries(c))w===!0&&h++;return h===Object.entries(c).length})()?l.current.checked=!0:l.current&&(l.current.checked=!1)},[c]);const N=()=>{if(!c)return!1;for(const[x,h]of Object.entries(c))if(h===!0)return!0;return!1},M=x=>{x.action&&(o.reset(),x.belongsTo="form",Q("bulkActionsAction",x).then(h=>{if(h.success===!0)switch(x.action){case"delete":k.success(s("Form successfully deleted.")),o.resetField("elements"),J(),y(V({page:p||1,perPage:A}));break}else k.error(h.error)}).catch(h=>{console.error(h),k.error(s("Unknown error, please retry later"))}))},u=[e.jsx(B,{page:p||1,perPage:A,mode:"save"})];return r?e.jsx(Te,{}):e.jsx(ee,{...o,children:e.jsx("form",{onSubmit:o.handleSubmit(M),children:e.jsxs(je,{actions:u,title:s("Forms list"),crumbs:[{label:s("Forms list")}],children:[e.jsx("div",{ref:i,children:N()&&e.jsx(Ee,{})}),d.records&&d.records.length>0?e.jsx("div",{className:"responsive",children:e.jsxs("table",{className:`acpt-table with-shadow ${a.is_rtl?"rtl":""}`,children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{style:{width:"24px"},children:e.jsxs("label",{className:"checkbox",htmlFor:"all",children:[e.jsx("input",{ref:l,type:"checkbox",id:"all",defaultChecked:!1,onClick:x=>{d.records.map(h=>{o.setValue(`elements.${h.id}`,x.currentTarget.checked)})}}),e.jsx("span",{})]})}),e.jsx("th",{children:s("Name")}),e.jsx("th",{children:s("Label")}),e.jsx("th",{children:s("Action")}),e.jsx("th",{children:s("Shortcode")}),e.jsx("th",{children:s("Actions")})]})}),e.jsx("tbody",{children:d.records&&d.records.map(x=>e.jsx(me,{record:x},x.id))}),F>1&&e.jsx("tfoot",{children:e.jsx("tr",{children:e.jsx("td",{colSpan:5,children:e.jsx(ke,{currentPage:p?parseInt(p):1,totalPages:F,baseLink:"/forms"})})})})]})}):e.jsx(K,{style:_.SECONDARY,children:s("No forms found.")})]})})})};Me.propTypes={};export{Me as default};
